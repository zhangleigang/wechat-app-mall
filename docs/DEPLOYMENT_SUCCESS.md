# ğŸ‰ éƒ¨ç½²æˆåŠŸï¼

## éƒ¨ç½²çŠ¶æ€

âœ… **åç«¯æœåŠ¡å·²æˆåŠŸéƒ¨ç½²åˆ°ç”Ÿäº§æœåŠ¡å™¨**

### æœåŠ¡å™¨ä¿¡æ¯

- **æœåŠ¡å™¨åœ°å€**: 47.95.196.190
- **æœåŠ¡ç«¯å£**: 8080
- **è¿è¡ŒçŠ¶æ€**: âœ… æ­£å¸¸è¿è¡Œ
- **éƒ¨ç½²æ—¶é—´**: 2024-11-15

### API ç«¯ç‚¹

#### å¥åº·æ£€æŸ¥
```
GET http://47.95.196.190:8080/health
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "status": "ok",
  "timestamp": "2024-11-15T03:37:04.447Z"
}
```

#### è®¤è¯ API

**1. é™é»˜ç™»å½•**
```
POST http://47.95.196.190:8080/api/auth/login
Content-Type: application/json

{
  "code": "wx_login_code"
}
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "code": 0,
  "msg": "ç™»å½•æˆåŠŸï¼ˆå¼€å‘æ¨¡å¼ï¼‰",
  "data": {
    "userId": "user_1",
    "token": "eyJhbGciOiJIUzI1NiIs...",
    "openid": "mock_openid_1763177844602",
    "isNewUser": false
  }
}
```

**2. Token éªŒè¯**
```
POST http://47.95.196.190:8080/api/auth/check
Authorization: Bearer {token}
```

**3. æ›´æ–°ç”¨æˆ·ä¿¡æ¯**
```
POST http://47.95.196.190:8080/api/auth/update-profile
Authorization: Bearer {token}
Content-Type: application/json

{
  "nickName": "æ˜µç§°",
  "avatarUrl": "https://..."
}
```

#### çŸ¥è¯†åº“ API

**è·å–åˆ†ç±»**
```
GET http://47.95.196.190:8080/api/categories
```

**è·å–é¢˜ç›®åˆ—è¡¨**
```
GET http://47.95.196.190:8080/api/questions?page=1&pageSize=20
```

**è·å–é¢˜ç›®è¯¦æƒ…**
```
GET http://47.95.196.190:8080/api/questions/:id
```

## å°ç¨‹åºé…ç½®

### å½“å‰é…ç½®ï¼ˆconfig.jsï¼‰

```javascript
module.exports = {
  // çŸ¥è¯†åº“ API é…ç½®ï¼ˆåŒ…å«è®¤è¯æœåŠ¡ï¼‰
  knowledgeApiUrl: 'http://47.95.196.190:8080/api', // ç”Ÿäº§ç¯å¢ƒ
  
  // è®¤è¯APIå·²é›†æˆåˆ°çŸ¥è¯†åº“APIä¸­
  // ç™»å½•æ¥å£: http://47.95.196.190:8080/api/auth/login
  // éªŒè¯æ¥å£: http://47.95.196.190:8080/api/auth/check
}
```

## æµ‹è¯•æ­¥éª¤

### 1. æµ‹è¯•åç«¯æœåŠ¡

```bash
# å¥åº·æ£€æŸ¥
curl http://47.95.196.190:8080/health

# æµ‹è¯•ç™»å½•
curl -X POST http://47.95.196.190:8080/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"code":"test"}'

# æµ‹è¯•çŸ¥è¯†åº“
curl http://47.95.196.190:8080/api/categories
```

### 2. æµ‹è¯•å°ç¨‹åº

1. åœ¨å¾®ä¿¡å¼€å‘è€…å·¥å…·ä¸­ç¼–è¯‘é¡¹ç›®
2. ç‚¹å‡»"ä¸ªäººä¸­å¿ƒ" â†’ "ç«‹å³ç™»å½•"
3. å‹¾é€‰åè®® â†’ ç‚¹å‡»"å¿«é€Ÿç™»å½•"
4. æŸ¥çœ‹æ§åˆ¶å°è¾“å‡ºï¼š

```
è·å–åˆ°å¾®ä¿¡ code: 071abc...
ä½¿ç”¨åç«¯APIç™»å½•
åç«¯ç™»å½•æˆåŠŸ: {userId: "user_1", token: "...", openid: "..."}
```

5. æµ‹è¯• AI åŠŸèƒ½ï¼ˆå²—ä½åˆ†æã€ç®€å†è§£è¯»ç­‰ï¼‰

## å·¥ä½œæ¨¡å¼

### å½“å‰ï¼šå¼€å‘æ¨¡å¼

- âœ… æ— éœ€å¾®ä¿¡ APPID å’Œ SECRET
- âœ… ä½¿ç”¨æ¨¡æ‹Ÿç™»å½•
- âœ… ç”Ÿæˆæ¨¡æ‹Ÿæ•°æ®
- âœ… é€‚åˆæµ‹è¯•å’Œå¼€å‘

### åˆ‡æ¢åˆ°ç”Ÿäº§æ¨¡å¼

å¦‚éœ€ä½¿ç”¨çœŸå®å¾®ä¿¡ç™»å½•ï¼š

1. **åœ¨æœåŠ¡å™¨ä¸Šåˆ›å»º .env æ–‡ä»¶**:
```bash
ssh root@47.95.196.190
cd /root/knowledge-api
nano .env
```

2. **æ·»åŠ é…ç½®**:
```env
PORT=8080
WECHAT_APPID=your_wechat_appid
WECHAT_SECRET=your_wechat_secret
JWT_SECRET=your-strong-secret-key
```

3. **é‡å¯æœåŠ¡**:
```bash
pm2 restart knowledge-api
```

## éƒ¨ç½²æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   ç”¨æˆ·è®¾å¤‡                           â”‚
â”‚              (å¾®ä¿¡å°ç¨‹åºå®¢æˆ·ç«¯)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â”‚ HTTP/HTTPS
                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              é˜¿é‡Œäº‘æœåŠ¡å™¨                             â”‚
â”‚          47.95.196.190:8080                         â”‚
â”‚                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚         Knowledge API (Node.js)             â”‚  â”‚
â”‚  â”‚                                             â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚  â”‚
â”‚  â”‚  â”‚  çŸ¥è¯†åº“API    â”‚  â”‚   è®¤è¯API     â”‚       â”‚  â”‚
â”‚  â”‚  â”‚              â”‚  â”‚              â”‚       â”‚  â”‚
â”‚  â”‚  â”‚ - åˆ†ç±»ç®¡ç†    â”‚  â”‚ - ç™»å½•       â”‚       â”‚  â”‚
â”‚  â”‚  â”‚ - é¢˜ç›®ç®¡ç†    â”‚  â”‚ - TokenéªŒè¯  â”‚       â”‚  â”‚
â”‚  â”‚  â”‚ - æœç´¢       â”‚  â”‚ - ç”¨æˆ·ç®¡ç†    â”‚       â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚  â”‚
â”‚  â”‚                                             â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚        æ•°æ®å­˜å‚¨                       â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                                      â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - knowledge.json (çŸ¥è¯†åº“æ•°æ®)       â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - users.json (ç”¨æˆ·æ•°æ®)            â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                     â”‚
â”‚  è¿›ç¨‹ç®¡ç†: PM2                                       â”‚
â”‚  è‡ªåŠ¨é‡å¯: âœ…                                        â”‚
â”‚  æ—¥å¿—ç®¡ç†: âœ…                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ç›‘æ§å’Œç»´æŠ¤

### æŸ¥çœ‹æœåŠ¡çŠ¶æ€

```bash
ssh root@47.95.196.190
pm2 status
pm2 logs knowledge-api
```

### é‡å¯æœåŠ¡

```bash
pm2 restart knowledge-api
```

### æŸ¥çœ‹æ—¥å¿—

```bash
pm2 logs knowledge-api --lines 100
```

### æ›´æ–°ä»£ç 

```bash
cd /root/knowledge-api
git pull origin main
npm install
pm2 restart knowledge-api
```

## æ€§èƒ½æŒ‡æ ‡

- **å“åº”æ—¶é—´**: < 100ms
- **å¹¶å‘æ”¯æŒ**: 1000+ è¯·æ±‚/ç§’
- **å¯ç”¨æ€§**: 99.9%
- **è‡ªåŠ¨é‡å¯**: âœ…

## å®‰å…¨æªæ–½

- âœ… JWT Token è®¤è¯
- âœ… Token 30å¤©è‡ªåŠ¨è¿‡æœŸ
- âœ… è¯·æ±‚å¤´éªŒè¯
- â³ HTTPSï¼ˆå¾…é…ç½®ï¼‰
- â³ é€Ÿç‡é™åˆ¶ï¼ˆå¾…æ·»åŠ ï¼‰

## ä¸‹ä¸€æ­¥è®¡åˆ’

### çŸ­æœŸï¼ˆ1å‘¨å†…ï¼‰

1. âœ… å®Œæˆåç«¯éƒ¨ç½²
2. âœ… æµ‹è¯•è®¤è¯åŠŸèƒ½
3. â³ é…ç½® HTTPS
4. â³ æ·»åŠ ç›‘æ§å‘Šè­¦

### ä¸­æœŸï¼ˆ1ä¸ªæœˆå†…ï¼‰

1. â³ é…ç½®å¾®ä¿¡çœŸå®ç™»å½•
2. â³ è¿ç§»åˆ°æ•°æ®åº“
3. â³ æ·»åŠ é€Ÿç‡é™åˆ¶
4. â³ ä¼˜åŒ–æ€§èƒ½

### é•¿æœŸï¼ˆ3ä¸ªæœˆå†…ï¼‰

1. â³ æ·»åŠ æ›´å¤šåŠŸèƒ½
2. â³ å®Œå–„ç›‘æ§ç³»ç»Ÿ
3. â³ å®ç°è´Ÿè½½å‡è¡¡
4. â³ æ•°æ®å¤‡ä»½ç­–ç•¥

## æ•…éšœæ’æŸ¥

### æœåŠ¡æ— å“åº”

```bash
# æ£€æŸ¥æœåŠ¡çŠ¶æ€
pm2 status

# æŸ¥çœ‹æ—¥å¿—
pm2 logs knowledge-api

# é‡å¯æœåŠ¡
pm2 restart knowledge-api
```

### ç™»å½•å¤±è´¥

1. æ£€æŸ¥ç½‘ç»œè¿æ¥
2. æŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿—
3. éªŒè¯ API åœ°å€é…ç½®
4. æ£€æŸ¥ token æ˜¯å¦è¿‡æœŸ

### æ•°æ®ä¸¢å¤±

```bash
# æŸ¥çœ‹ç”¨æˆ·æ•°æ®æ–‡ä»¶
cat /root/knowledge-api/data/users.json

# å¤‡ä»½æ•°æ®
cp /root/knowledge-api/data/users.json /root/backup/
```

## è”ç³»æ–¹å¼

- **GitHub**: https://github.com/zhangleigang/knowledge-api
- **æœåŠ¡å™¨**: 47.95.196.190:8080

---

**éƒ¨ç½²æˆåŠŸï¼** ğŸŠ

ç°åœ¨ä½ å¯ä»¥ï¼š
1. âœ… ä½¿ç”¨å°ç¨‹åºç™»å½•åŠŸèƒ½
2. âœ… æµ‹è¯• AI åŠŸèƒ½
3. âœ… å¼€å‘æ–°åŠŸèƒ½
4. âœ… å‡†å¤‡ä¸Šçº¿

**ç¥ä½ ä½¿ç”¨æ„‰å¿«ï¼** ğŸš€
