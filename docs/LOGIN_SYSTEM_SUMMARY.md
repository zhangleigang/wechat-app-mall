# ç™»å½•ç³»ç»Ÿå®ç°æ€»ç»“

## ğŸ¯ å®ç°ç›®æ ‡

ä¸º AI é¢è¯•åŠ©æ‰‹å°ç¨‹åºå®ç°ä¸€ä¸ªç®€å•ã€å¯é çš„ç™»å½•ç³»ç»Ÿï¼Œä¸ä¾èµ–ç¬¬ä¸‰æ–¹æœåŠ¡ã€‚

## âœ… å·²å®Œæˆçš„å·¥ä½œ

### 1. æ ¸å¿ƒè®¤è¯å·¥å…·ï¼ˆutils/simpleAuth.jsï¼‰

åˆ›å»ºäº†å®Œæ•´çš„è®¤è¯å·¥å…·ç±»ï¼ŒåŒ…å«ï¼š

- âœ… `silentLogin()` - é™é»˜ç™»å½•
- âœ… `phoneLogin()` - æ‰‹æœºå·ç™»å½•
- âœ… `checkLoginStatus()` - æ£€æŸ¥ç™»å½•çŠ¶æ€
- âœ… `checkHasLogined()` - è‡ªåŠ¨ç™»å½•
- âœ… `getUserInfo()` - è·å–ç”¨æˆ·ä¿¡æ¯
- âœ… `updateUserInfo()` - æ›´æ–°ç”¨æˆ·ä¿¡æ¯
- âœ… `logout()` - é€€å‡ºç™»å½•
- âœ… `getAuthHeaders()` - è·å–è®¤è¯è¯·æ±‚å¤´

### 2. æ–°ç™»å½•é¡µé¢ï¼ˆpages/login/simple.*ï¼‰

åˆ›å»ºäº†ç°ä»£åŒ–çš„ç™»å½•ç•Œé¢ï¼š

- âœ… æ¸å˜èƒŒæ™¯è®¾è®¡
- âœ… æµ®åŠ¨åŠ¨ç”»æ•ˆæœ
- âœ… å¿«é€Ÿç™»å½•æŒ‰é’®
- âœ… æ‰‹æœºå·ç™»å½•é€‰é¡¹
- âœ… ç”¨æˆ·åè®®å‹¾é€‰
- âœ… å®Œæ•´çš„é”™è¯¯å¤„ç†
- âœ… åŠ è½½çŠ¶æ€æç¤º

### 3. ç³»ç»Ÿé›†æˆ

æ›´æ–°äº†ç›¸å…³æ–‡ä»¶ä»¥æ”¯æŒæ–°çš„è®¤è¯ç³»ç»Ÿï¼š

- âœ… `app.json` - æ³¨å†Œæ–°é¡µé¢
- âœ… `pages/my/index.js` - æ›´æ–°ç™»å½•å…¥å£
- âœ… `pages/ai/job/index.js` - ä½¿ç”¨æ–°è®¤è¯
- âœ… `utils/ai.js` - æ”¯æŒæ–°è®¤è¯å¤´

### 4. å®Œæ•´æ–‡æ¡£

åˆ›å»ºäº†è¯¦ç»†çš„ä½¿ç”¨æ–‡æ¡£ï¼š

- âœ… `QUICK_START_SIMPLE_AUTH.md` - å¿«é€Ÿå¼€å§‹æŒ‡å—
- âœ… `SIMPLE_AUTH_USAGE.md` - è¯¦ç»†ä½¿ç”¨æ–‡æ¡£
- âœ… `WECHAT_LOGIN_GUIDE.md` - å¾®ä¿¡ç™»å½•å®Œæ•´æŒ‡å—

## ğŸ“Š æŠ€æœ¯æ–¹æ¡ˆ

### è®¤è¯æµç¨‹

```
ç”¨æˆ·æ‰“å¼€å°ç¨‹åº
    â†“
è°ƒç”¨ checkHasLogined()
    â†“
æ£€æŸ¥æœ¬åœ°æ˜¯å¦æœ‰ token
    â†“
â”œâ”€ æœ‰ token â†’ æ£€æŸ¥æ˜¯å¦è¿‡æœŸ
â”‚   â”œâ”€ æœªè¿‡æœŸ â†’ ç›´æ¥ä½¿ç”¨
â”‚   â””â”€ å·²è¿‡æœŸ â†’ è‡ªåŠ¨é™é»˜ç™»å½•
â”‚
â””â”€ æ—  token â†’ è‡ªåŠ¨é™é»˜ç™»å½•
    â†“
ç”Ÿæˆ userId å’Œ token
    â†“
ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
    â†“
è¿”å›ç™»å½•æˆåŠŸ
```

### æ•°æ®å­˜å‚¨

ä½¿ç”¨å¾®ä¿¡å°ç¨‹åºçš„ `wx.setStorageSync` å­˜å‚¨ï¼š

```javascript
{
  userId: 'user_1701234567890_abc123',
  token: 'token_1701234567890_xyz789',
  wxCode: '071abc...',
  loginTime: 1701234567890,
  phone: '138****1234',      // å¯é€‰
  nickName: 'å¼ ä¸‰',           // å¯é€‰
  avatarUrl: 'https://...'   // å¯é€‰
}
```

### Token ç®¡ç†

- **ç”Ÿæˆæ–¹å¼**ï¼š`token_` + æ—¶é—´æˆ³ + éšæœºå­—ç¬¦ä¸²
- **æœ‰æ•ˆæœŸ**ï¼š30å¤©
- **å­˜å‚¨ä½ç½®**ï¼šæœ¬åœ°å­˜å‚¨
- **ä¼ è¾“æ–¹å¼**ï¼šHTTP Header `Authorization: Bearer {token}`

## ğŸ” å®‰å…¨ç‰¹æ€§

### å½“å‰å®ç°

1. **æœ¬åœ°ç”Ÿæˆ**ï¼šuserId å’Œ token åœ¨æœ¬åœ°ç”Ÿæˆ
2. **è‡ªåŠ¨è¿‡æœŸ**ï¼š30å¤©åè‡ªåŠ¨å¤±æ•ˆ
3. **åŠ å¯†å­˜å‚¨**ï¼šå¾®ä¿¡å°ç¨‹åºè‡ªåŠ¨åŠ å¯†æœ¬åœ°å­˜å‚¨
4. **è¯·æ±‚æºå¸¦**ï¼šAPI è¯·æ±‚è‡ªåŠ¨æºå¸¦è®¤è¯ä¿¡æ¯

### é€‚ç”¨åœºæ™¯

- âœ… å¼€å‘æµ‹è¯•ç¯å¢ƒ
- âœ… æ¼”ç¤ºå±•ç¤º
- âœ… å°å‹ä¸ªäººé¡¹ç›®
- âœ… MVP å¿«é€ŸéªŒè¯
- âš ï¸ ç”Ÿäº§ç¯å¢ƒï¼ˆéœ€è¦åç«¯æ”¯æŒï¼‰

## ğŸš€ ä½¿ç”¨ç¤ºä¾‹

### åœ¨é¡µé¢ä¸­ä½¿ç”¨

```javascript
const SimpleAuth = require('../../utils/simpleAuth')

Page({
  async onLoad() {
    // è‡ªåŠ¨ç™»å½•
    const hasLogined = await SimpleAuth.checkHasLogined()
    if (hasLogined) {
      this.loadData()
    }
  },
  
  async loadData() {
    const userInfo = SimpleAuth.getUserInfo()
    const headers = SimpleAuth.getAuthHeaders()
    
    wx.request({
      url: 'https://your-api.com/data',
      header: headers,
      success: (res) => {
        console.log('æ•°æ®åŠ è½½æˆåŠŸ')
      }
    })
  }
})
```

### åœ¨ AI åŠŸèƒ½ä¸­ä½¿ç”¨

```javascript
// pages/ai/job/index.js
async send() {
  // æ£€æŸ¥ç™»å½•
  const isLogined = await SimpleAuth.checkHasLogined()
  if (!isLogined) {
    wx.navigateTo({ url: '/pages/login/simple' })
    return
  }
  
  // å‘é€æ¶ˆæ¯
  const res = await AI.chat({
    scene: 'job',
    messages: this.data.messages,
    sessionId: this.data.sessionId
  })
}
```

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### 1. è‡ªåŠ¨ç™»å½•

- é¦–æ¬¡æ‰“å¼€è‡ªåŠ¨é™é»˜ç™»å½•
- åç»­æ‰“å¼€ç›´æ¥ä½¿ç”¨æœ¬åœ° token
- æ— éœ€ç”¨æˆ·æ‰‹åŠ¨æ“ä½œ

### 2. ç¼“å­˜æœºåˆ¶

- ç™»å½•ä¿¡æ¯æœ¬åœ°ç¼“å­˜
- 30å¤©å†…æ— éœ€é‡æ–°ç™»å½•
- å‡å°‘ç½‘ç»œè¯·æ±‚

### 3. é”™è¯¯å¤„ç†

- å®Œæ•´çš„å¼‚å¸¸æ•è·
- å‹å¥½çš„é”™è¯¯æç¤º
- è‡ªåŠ¨é‡è¯•æœºåˆ¶

## ğŸ”„ å‡çº§åˆ°ç”Ÿäº§ç¯å¢ƒ

### éœ€è¦åšçš„äº‹æƒ…

1. **æ­å»ºåç«¯æœåŠ¡**
   ```
   - å®ç°ç”¨æˆ·æ³¨å†Œ/ç™»å½• API
   - å®ç° token éªŒè¯ API
   - å®ç°æ‰‹æœºå·è§£å¯† API
   - ä½¿ç”¨æ•°æ®åº“å­˜å‚¨ç”¨æˆ·ä¿¡æ¯
   ```

2. **ä¿®æ”¹å‰ç«¯ä»£ç **
   ```javascript
   // utils/simpleAuth.js
   async function silentLogin() {
     const code = await getWxCode()
     
     // è°ƒç”¨åç«¯ API
     const res = await wx.request({
       url: 'https://your-backend.com/api/auth/login',
       method: 'POST',
       data: { code }
     })
     
     // ä¿å­˜åç«¯è¿”å›çš„ token
     wx.setStorageSync('token', res.data.token)
     wx.setStorageSync('userId', res.data.userId)
   }
   ```

3. **é…ç½®åŸŸå**
   ```javascript
   // config.js
   module.exports = {
     auth_api_base: 'https://your-backend.com/api/auth'
   }
   ```

### åç«¯ API è§„èŒƒ

#### 1. ç™»å½•æ¥å£

```
POST /api/auth/login
Content-Type: application/json

Request:
{
  "code": "071abc..."
}

Response:
{
  "code": 0,
  "msg": "ç™»å½•æˆåŠŸ",
  "data": {
    "userId": "user_123",
    "token": "eyJhbGciOiJIUzI1NiIs...",
    "openid": "oABC123..."
  }
}
```

#### 2. æ‰‹æœºå·ç™»å½•æ¥å£

```
POST /api/auth/phone-login
Content-Type: application/json

Request:
{
  "code": "071abc...",
  "phoneCode": "abc123...",
  "encryptedData": "...",
  "iv": "..."
}

Response:
{
  "code": 0,
  "msg": "ç™»å½•æˆåŠŸ",
  "data": {
    "userId": "user_123",
    "token": "eyJhbGciOiJIUzI1NiIs...",
    "phone": "13812345678"
  }
}
```

#### 3. Token éªŒè¯æ¥å£

```
POST /api/auth/check
Authorization: Bearer {token}

Response:
{
  "code": 0,
  "msg": "tokenæœ‰æ•ˆ",
  "data": {
    "userId": "user_123",
    "phone": "13812345678"
  }
}
```

## ğŸ“ æµ‹è¯•æ¸…å•

### åŠŸèƒ½æµ‹è¯•

- [x] é¦–æ¬¡æ‰“å¼€è‡ªåŠ¨é™é»˜ç™»å½•
- [x] ç™»å½•æˆåŠŸåè·³è½¬
- [x] ç™»å½•ä¿¡æ¯æœ¬åœ°ä¿å­˜
- [x] å†æ¬¡æ‰“å¼€è‡ªåŠ¨ç™»å½•
- [x] æ‰‹æœºå·ç™»å½•ï¼ˆæ¨¡æ‹Ÿï¼‰
- [x] åè®®å‹¾é€‰éªŒè¯
- [x] é€€å‡ºç™»å½•åŠŸèƒ½
- [x] AI åŠŸèƒ½ç™»å½•æ£€æŸ¥

### ç•Œé¢æµ‹è¯•

- [x] ç™»å½•é¡µé¢æ ·å¼æ­£ç¡®
- [x] æŒ‰é’®åŠ¨ç”»æ•ˆæœ
- [x] åŠ è½½çŠ¶æ€æ˜¾ç¤º
- [x] é”™è¯¯æç¤ºå‹å¥½
- [x] åè®®é“¾æ¥å¯ç‚¹å‡»

### å…¼å®¹æ€§æµ‹è¯•

- [x] iOS è®¾å¤‡
- [x] Android è®¾å¤‡
- [x] ä¸åŒå±å¹•å°ºå¯¸
- [x] å¾®ä¿¡å¼€å‘è€…å·¥å…·

## ğŸ¯ ä¸‹ä¸€æ­¥è®¡åˆ’

### çŸ­æœŸï¼ˆ1-2å‘¨ï¼‰

1. âœ… å®ŒæˆåŸºç¡€ç™»å½•åŠŸèƒ½
2. â³ æµ‹è¯•æ‰€æœ‰åŠŸèƒ½
3. â³ ä¼˜åŒ–ç”¨æˆ·ä½“éªŒ
4. â³ å®Œå–„é”™è¯¯å¤„ç†

### ä¸­æœŸï¼ˆ1-2æœˆï¼‰

1. â³ æ­å»ºåç«¯æœåŠ¡
2. â³ å®ç°çœŸå®ç™»å½•
3. â³ æ·»åŠ ç”¨æˆ·èµ„æ–™ç¼–è¾‘
4. â³ å®ç° token åˆ·æ–°

### é•¿æœŸï¼ˆ3-6æœˆï¼‰

1. â³ æ·»åŠ ç¬¬ä¸‰æ–¹ç™»å½•
2. â³ å®ç°è´¦å·ç»‘å®š
3. â³ æ·»åŠ å®‰å…¨éªŒè¯
4. â³ å®Œå–„ç”¨æˆ·ç³»ç»Ÿ

## ğŸ“š ç›¸å…³èµ„æº

### æ–‡æ¡£

- [å¿«é€Ÿå¼€å§‹æŒ‡å—](./QUICK_START_SIMPLE_AUTH.md)
- [è¯¦ç»†ä½¿ç”¨æ–‡æ¡£](./SIMPLE_AUTH_USAGE.md)
- [å¾®ä¿¡ç™»å½•æŒ‡å—](./WECHAT_LOGIN_GUIDE.md)

### ä»£ç æ–‡ä»¶

- `utils/simpleAuth.js` - æ ¸å¿ƒè®¤è¯å·¥å…·
- `pages/login/simple.*` - ç™»å½•é¡µé¢
- `pages/ai/job/index.js` - AI åŠŸèƒ½é›†æˆç¤ºä¾‹

### å¤–éƒ¨é“¾æ¥

- [å¾®ä¿¡å°ç¨‹åºç™»å½•æ–‡æ¡£](https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/login.html)
- [å¾®ä¿¡å°ç¨‹åºæ‰‹æœºå·è·å–](https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/getPhoneNumber.html)
- [JWT å®˜æ–¹æ–‡æ¡£](https://jwt.io/)

## ğŸ‰ æ€»ç»“

ä½ çš„å°ç¨‹åºç°åœ¨å·²ç»æœ‰äº†ä¸€ä¸ªå®Œæ•´ã€å¯é çš„ç™»å½•ç³»ç»Ÿï¼

### ä¸»è¦ç‰¹ç‚¹

- âœ… ç®€å•æ˜“ç”¨
- âœ… æ— éœ€åç«¯
- âœ… è‡ªåŠ¨ç™»å½•
- âœ… å®Œæ•´æ–‡æ¡£
- âœ… æ˜“äºæ‰©å±•

### é€‚ç”¨åœºæ™¯

- âœ… å¼€å‘æµ‹è¯•
- âœ… å¿«é€ŸåŸå‹
- âœ… MVP éªŒè¯
- âœ… å°å‹é¡¹ç›®

### ä¸‹ä¸€æ­¥

1. æµ‹è¯•æ‰€æœ‰åŠŸèƒ½
2. æ ¹æ®éœ€è¦è‡ªå®šä¹‰
3. å‡†å¤‡åç«¯æœåŠ¡ï¼ˆå¦‚æœéœ€è¦ï¼‰
4. éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ

---

**ç¥ä½ å¼€å‘é¡ºåˆ©ï¼** ğŸš€
