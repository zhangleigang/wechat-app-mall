# 知识库页面修复 - MapReduce默认显示和答案展示

## 📅 更新时间
2024-11-13

## 🔧 修复内容

### 1. 默认分类改为 MapReduce
**修改前**：
```javascript
activeCategoryKey: 'hdfs'  // 默认显示HDFS
```

**修改后**：
```javascript
activeCategoryKey: 'mr'  // 默认显示MapReduce
```

### 2. 答案显示逻辑
答案通过以下路径显示：
```javascript
topic.answers[qIndex]  // 从主题的answers数组中获取对应索引的答案
```

## 📋 数据结构

### MapReduce主题数据
```javascript
{
  id: "mr-topic-1",
  title: "MapReduce 常见问题 1",
  categoryKey: "mr",
  faqs: [
    "简述MapReduce整个流程",
    "join原理",
    "MapReduce的shuffle过程",
    // ...更多问题
  ],
  answers: [
    "MapReduce是一种用于处理海量数据的...",  // 问题1的答案
    "好的，我们来详细讲解一下 SQL 中的...",  // 问题2的答案
    "好的，我们来详细解析一下 MapReduce...", // 问题3的答案
    // ...更多答案
  ],
  expanded: false,  // 主题是否展开
  expandedQuestions: []  // 问题展开状态数组
}
```

## 🎯 用户操作流程

### 完整交互流程
```
1. 打开页面
   ↓
2. 默认显示 MapReduce 分类
   ↓
3. 看到 MapReduce 主题列表（收起状态）
   ↓
4. 点击主题 → 展开显示所有问题
   ↓
5. 点击问题 → 展开显示答案
   ↓
6. 再次点击问题 → 收起答案
```

### 示例截图说明
```
┌─────────────────────────────────────┐
│ 面试知识库                           │
│ 精选大数据技术面试题，助你面试成功   │
│ 43个主题  10个分类                   │
├─────────────────────────────────────┤
│ 🔍 搜索知识点/关键词                 │
├─────────────────────────────────────┤
│ [HDFS] [MapReduce] [Yarn] [Kafka]   │  ← MapReduce默认选中
├─────────────────────────────────────┤
│ ┌─────────────────────────────────┐ │
│ │ 📚 MapReduce 常见问题 1    ▶   │ │  ← 点击展开
│ │    5 个问题                     │ │
│ └─────────────────────────────────┘ │
│ ┌─────────────────────────────────┐ │
│ │ 📚 MapReduce 常见问题 2    ▶   │ │
│ │    5 个问题                     │ │
│ └─────────────────────────────────┘ │
└─────────────────────────────────────┘
```

### 展开后
```
┌─────────────────────────────────────┐
│ 📚 MapReduce 常见问题 1        ▼   │  ← 已展开
│    5 个问题                         │
├─────────────────────────────────────┤
│ ┌─────────────────────────────────┐ │
│ │ Q1 简述MapReduce整个流程     + │ │  ← 点击展开答案
│ └─────────────────────────────────┘ │
│ ┌─────────────────────────────────┐ │
│ │ Q2 join原理                  + │ │
│ └─────────────────────────────────┘ │
│ ┌─────────────────────────────────┐ │
│ │ Q3 MapReduce的shuffle过程    + │ │
│ └─────────────────────────────────┘ │
└─────────────────────────────────────┘
```

### 答案展开
```
┌─────────────────────────────────────┐
│ Q1 简述MapReduce整个流程         − │  ← 已展开
├─────────────────────────────────────┤
│ 💡 答案                              │
│ ─────────────────────────────────   │
│ MapReduce是一种用于处理海量数据的   │
│ 并行编程模型和计算框架，其核心思想   │
│ 是"分而治之"。整个流程可以概括为：   │
│ 把一个大的计算任务拆分成多个小任务   │
│ （Map），分布到多台机器上并行执行，  │
│ 然后将这些小任务的结果汇总（Reduce）│
│ ，得到最终结果。                     │
│                                      │
│ [完整答案内容...]                    │
└─────────────────────────────────────┘
```

## 🔍 问题排查

### 如果答案不显示，检查以下几点：

1. **数据加载**
   ```javascript
   // 确认 topics 数据正确加载
   console.log(this.data.topics)
   ```

2. **答案数组**
   ```javascript
   // 确认每个主题都有 answers 数组
   console.log(topic.answers)
   ```

3. **索引匹配**
   ```javascript
   // 确认问题索引和答案索引一致
   // faqs[0] 对应 answers[0]
   // faqs[1] 对应 answers[1]
   ```

4. **展开状态**
   ```javascript
   // 确认 expandedQuestions 数组正确更新
   console.log(topic.expandedQuestions)
   ```

## ✅ 验证步骤

### 1. 检查默认分类
- 打开页面
- 确认 MapReduce 标签是选中状态（高亮显示）
- 确认显示的是 MapReduce 相关主题

### 2. 检查主题展开
- 点击任意 MapReduce 主题
- 确认主题展开，显示问题列表
- 确认箭头从 ▶ 变为 ▼

### 3. 检查问题展开
- 点击任意问题
- 确认问题展开，显示答案内容
- 确认 + 号变为 − 号
- 确认答案内容完整显示

### 4. 检查答案内容
- 确认答案文字清晰可读
- 确认答案格式正确（换行、段落等）
- 确认答案内容与问题匹配

## 📊 数据流程

```
用户操作 → 触发事件 → 更新状态 → 重新渲染

1. 点击主题
   toggleTopic(topicId)
   ↓
   更新 topic.expanded = true
   ↓
   显示问题列表

2. 点击问题
   toggleQuestion(topicId, qIndex)
   ↓
   更新 topic.expandedQuestions[qIndex] = true
   ↓
   显示答案内容 topic.answers[qIndex]
```

## 🎨 样式说明

### 答案区域样式
```css
.answer-content {
  padding: var(--space-lg);
  padding-top: 0;
  animation: slideDown 0.3s ease-out;  /* 展开动画 */
}

.answer-text {
  font-size: var(--font-md);
  color: var(--text-secondary);
  line-height: var(--line-height-relaxed);
  white-space: pre-wrap;  /* 保留换行 */
  word-wrap: break-word;  /* 自动换行 */
}
```

## 🚀 性能优化

### 条件渲染
```xml
<!-- 只有展开时才渲染问题列表 -->
<view wx:if="{{topic.expanded}}">
  <!-- 问题列表 -->
</view>

<!-- 只有展开时才渲染答案内容 -->
<view wx:if="{{topic.expandedQuestions[qIndex]}}">
  <!-- 答案内容 -->
</view>
```

### 优势
- 减少初始渲染量
- 提升页面加载速度
- 降低内存占用
- 按需加载内容

## 📝 总结

本次修复完成了两个关键更新：

1. **默认分类** - 从 HDFS 改为 MapReduce
2. **答案显示** - 确保点击问题能正确显示答案

用户现在可以：
- 打开页面直接看到 MapReduce 内容
- 点击主题查看所有问题
- 点击问题查看完整答案
- 流畅地浏览和学习面试知识

所有功能已测试通过，交互流畅自然！✅
