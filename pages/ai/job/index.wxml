<view class="page-container">
  <!-- é¡µé¢å¤´éƒ¨ -->
  <view class="gradient-header">
    <text class="text-2xl text-bold text-white">å²—ä½åˆ†æ</text>
    <text class="text-sm text-white mt-sm" style="opacity: 0.9;">
      AIæ™ºèƒ½åˆ†æå²—ä½éœ€æ±‚ï¼ŒåŠ©ä½ ç²¾å‡†åŒ¹é…
    </text>
  </view>
  
  <!-- å¿«æ·é—®é¢˜ï¼ˆé¦–æ¬¡è¿›å…¥æ—¶æ˜¾ç¤ºï¼‰ -->
  <view wx:if="{{messages.length === 0}}" class="quick-questions-section">
    <view class="quick-title">
      <text class="quick-title-text">ğŸ’¡ å¿«æ·é—®é¢˜</text>
      <text class="quick-subtitle">ç‚¹å‡»å¿«é€Ÿå¼€å§‹åˆ†æ</text>
    </view>
    
    <view class="quick-grid">
      <view 
        wx:for="{{quickQuestions}}" 
        wx:key="index"
        class="quick-item"
        bindtap="selectQuickQuestion"
        data-question="{{item}}"
      >
        <text class="quick-text">{{item}}</text>
      </view>
    </view>
  </view>
  
  <!-- å¯¹è¯åŒºåŸŸ -->
  <scroll-view 
    class="chat-container" 
    scroll-y="true" 
    scroll-top="{{scrollTop}}" 
    scroll-with-animation="true"
    enhanced="true"
    show-scrollbar="false"
  >
    <view class="messages-wrapper">
      <block wx:for="{{messages}}" wx:key="index">
        <view class="message-item {{item.role === 'user' ? 'user-message' : 'ai-message'}}">
          <!-- ç”¨æˆ·æ¶ˆæ¯ -->
          <view wx:if="{{item.role === 'user'}}" class="user-bubble">
            <view class="message-avatar user-avatar">
              <text class="avatar-text">æˆ‘</text>
            </view>
            <view class="message-bubble user-bubble-content">
              <text class="message-text">{{item.content}}</text>
              <text class="message-time">{{item.time}}</text>
            </view>
          </view>
          
          <!-- AIæ¶ˆæ¯ -->
          <view wx:else class="ai-bubble">
            <view class="message-avatar ai-avatar">
              <text class="avatar-text">AI</text>
            </view>
            <view class="message-bubble ai-bubble-content">
              <text class="message-text">{{item.content}}</text>
              <text class="message-time">{{item.time}}</text>
              
              <!-- æ“ä½œæŒ‰é’® -->
              <view class="message-actions">
                <view class="action-btn" bindtap="copyMessage" data-content="{{item.content}}">
                  <text class="action-icon">ğŸ“‹</text>
                  <text class="action-text">å¤åˆ¶</text>
                </view>
                <view class="action-btn" bindtap="likeMessage" data-index="{{index}}">
                  <text class="action-icon">ğŸ‘</text>
                  <text class="action-text">æœ‰ç”¨</text>
                </view>
              </view>
            </view>
          </view>
        </view>
      </block>
      
      <!-- AIæ­£åœ¨å›å¤çš„æç¤º -->
      <view wx:if="{{sending}}" class="message-item ai-message">
        <view class="ai-bubble">
          <view class="message-avatar ai-avatar">
            <text class="avatar-text">AI</text>
          </view>
          <view class="message-bubble ai-bubble-content typing-bubble">
            <view class="typing-indicator">
              <text class="typing-text">AIæ­£åœ¨åˆ†æä¸­</text>
              <view class="typing-dots">
                <view class="dot"></view>
                <view class="dot"></view>
                <view class="dot"></view>
              </view>
            </view>
          </view>
        </view>
      </view>
      
      <!-- åº•éƒ¨å ä½ -->
      <view class="messages-bottom"></view>
    </view>
  </scroll-view>
  
  <!-- è¾“å…¥åŒºåŸŸ -->
  <view class="input-section">
    <!-- åŠŸèƒ½æŒ‰é’®æ  -->
    <view wx:if="{{messages.length > 0}}" class="function-bar">
      <view class="function-btn" bindtap="clearChat">
        <text class="function-icon">ğŸ—‘ï¸</text>
        <text class="function-text">æ¸…ç©º</text>
      </view>
      <view class="function-btn" bindtap="exportChat">
        <text class="function-icon">ğŸ“¤</text>
        <text class="function-text">å¯¼å‡º</text>
      </view>
    </view>
    
    <!-- è¾“å…¥æ¡† -->
    <view class="input-container">
      <view class="input-wrapper">
        <textarea 
          class="message-input" 
          placeholder="è¯·è¾“å…¥å²—ä½æè¿°æˆ–JDé“¾æ¥..." 
          value="{{inputVal}}" 
          bindinput="handleInput"
          bindconfirm="send"
          auto-height
          maxlength="2000"
          show-confirm-bar="false"
        ></textarea>
        
        <!-- å­—æ•°ç»Ÿè®¡ -->
        <view wx:if="{{inputVal.length > 0}}" class="char-count">
          <text class="count-text">{{inputVal.length}}/2000</text>
        </view>
      </view>
      
      <!-- å‘é€æŒ‰é’® -->
      <view class="send-button-wrapper">
        <button 
          class="send-button {{inputVal && !sending ? 'active' : 'disabled'}}" 
          bindtap="send" 
          disabled="{{!inputVal || sending}}"
        >
          <text wx:if="{{sending}}" class="send-icon loading">â³</text>
          <text wx:else class="send-icon">ğŸš€</text>
        </button>
      </view>
    </view>
  </view>
</view>