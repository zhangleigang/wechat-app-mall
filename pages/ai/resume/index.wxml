<view class="page-container">
  <!-- é¡µé¢å¤´éƒ¨ -->
  <view class="gradient-header">
    <view class="header-content">
      <view class="header-text">
        <text class="text-2xl text-bold text-white">ç®€å†è§£è¯»</text>
        <text class="text-sm text-white mt-xs" style="opacity: 0.9;">
          AIæ™ºèƒ½åˆ†æç®€å†ï¼Œæä¾›ä¼˜åŒ–å»ºè®®
        </text>
      </view>
      <button class="header-upload-btn" bindtap="uploadResume">
        <text class="btn-icon">ğŸ“¤</text>
        <text class="btn-text">ä¸Šä¼ </text>
      </button>
    </view>
  </view>
  
  <!-- ä¸Šä¼ å¼•å¯¼åŒºåŸŸï¼ˆæœªä¸Šä¼ æ—¶æ˜¾ç¤ºï¼‰ -->
  <view wx:if="{{!resumeStatus.uploaded}}" class="upload-section">
    <view class="upload-icon">ğŸ“„</view>
    <text class="upload-title">ä¸Šä¼ ç®€å†å¼€å§‹åˆ†æ</text>
    <text class="upload-desc">æ”¯æŒ PDFã€Wordã€å›¾ç‰‡æ ¼å¼</text>
    <button class="upload-btn" bindtap="uploadResume">
      <text class="upload-btn-text">é€‰æ‹©æ–‡ä»¶</text>
    </button>
  </view>
  
  <!-- ç®€å†çŠ¶æ€å¡ç‰‡ï¼ˆå·²ä¸Šä¼ æ—¶æ˜¾ç¤ºï¼‰ -->
  <view wx:if="{{resumeStatus.uploaded}}" class="resume-status-card">
    <view class="status-icon">âœ…</view>
    <view class="status-info">
      <text class="file-name">{{resumeStatus.fileName}}</text>
      <text class="upload-time">ä¸Šä¼ äº {{resumeStatus.uploadTime}}</text>
    </view>
    <button class="reupload-btn" bindtap="uploadResume">
      <text class="reupload-text">é‡æ–°ä¸Šä¼ </text>
    </button>
  </view>
  
  <!-- å¿«æ·åˆ†æé€‰é¡¹ï¼ˆå·²ä¸Šä¼ æ—¶æ˜¾ç¤ºï¼‰ -->
  <view wx:if="{{resumeStatus.uploaded && messages.length === 0}}" class="quick-analysis-section">
    <text class="quick-analysis-title">ğŸ’¡ å¿«é€Ÿåˆ†æ</text>
    <scroll-view class="quick-analysis-scroll" scroll-x="true" show-scrollbar="false">
      <view class="quick-analysis-list">
        <view 
          wx:for="{{quickAnalysis}}" 
          wx:key="index"
          class="quick-analysis-item"
          bindtap="selectAnalysis"
          data-question="{{item}}"
        >
          <text class="quick-analysis-text">{{item}}</text>
        </view>
      </view>
    </scroll-view>
  </view>
  
  <!-- å¯¹è¯åŒºåŸŸ -->
  <scroll-view 
    class="chat-container" 
    scroll-y="true" 
    scroll-top="{{scrollTop}}" 
    scroll-with-animation="true"
    enhanced="true"
    show-scrollbar="false"
  >
    <view class="messages-wrapper">
      <block wx:for="{{messages}}" wx:key="index">
        <view class="message-item {{item.role === 'user' ? 'user-message' : 'ai-message'}}">
          <!-- ç”¨æˆ·æ¶ˆæ¯ -->
          <view wx:if="{{item.role === 'user'}}" class="user-bubble">
            <view class="message-avatar user-avatar">
              <text class="avatar-text">æˆ‘</text>
            </view>
            <view class="message-bubble user-bubble-content">
              <text class="message-text">{{item.content}}</text>
              <text class="message-time">{{item.time}}</text>
            </view>
          </view>
          
          <!-- AIæ¶ˆæ¯ -->
          <view wx:else class="ai-bubble">
            <view class="message-avatar ai-avatar">
              <text class="avatar-text">AI</text>
            </view>
            <view class="message-bubble ai-bubble-content">
              <text class="message-text">{{item.content}}</text>
              <text class="message-time">{{item.time}}</text>
              
              <!-- æ“ä½œæŒ‰é’® -->
              <view class="message-actions">
                <view class="action-btn" bindtap="copyMessage" data-content="{{item.content}}">
                  <text class="action-icon">ğŸ“‹</text>
                  <text class="action-text">å¤åˆ¶</text>
                </view>
                <view class="action-btn" bindtap="likeMessage" data-index="{{index}}">
                  <text class="action-icon">ğŸ‘</text>
                  <text class="action-text">æœ‰ç”¨</text>
                </view>
              </view>
            </view>
          </view>
        </view>
      </block>
      
      <!-- AIæ­£åœ¨å›å¤çš„æç¤º -->
      <view wx:if="{{sending}}" class="message-item ai-message">
        <view class="ai-bubble">
          <view class="message-avatar ai-avatar">
            <text class="avatar-text">AI</text>
          </view>
          <view class="message-bubble ai-bubble-content typing-bubble">
            <view class="typing-indicator">
              <text class="typing-text">AIæ­£åœ¨åˆ†æä¸­</text>
              <view class="typing-dots">
                <view class="dot"></view>
                <view class="dot"></view>
                <view class="dot"></view>
              </view>
            </view>
          </view>
        </view>
      </view>
      
      <!-- åº•éƒ¨å ä½ -->
      <view class="messages-bottom"></view>
    </view>
  </scroll-view>
  
  <!-- è¾“å…¥åŒºåŸŸ -->
  <view class="input-section">
    <!-- åŠŸèƒ½æŒ‰é’®æ  -->
    <view wx:if="{{messages.length > 0}}" class="function-bar">
      <view class="function-btn" bindtap="clearChat">
        <text class="function-icon">ğŸ—‘ï¸</text>
        <text class="function-text">æ¸…ç©º</text>
      </view>
      <view class="function-btn" bindtap="exportChat">
        <text class="function-icon">ğŸ“¤</text>
        <text class="function-text">å¯¼å‡º</text>
      </view>
    </view>
    
    <!-- è¾“å…¥æ¡† -->
    <view class="input-container">
      <view class="input-wrapper">
        <textarea 
          class="message-input" 
          placeholder="è¯·è¾“å…¥é—®é¢˜ï¼Œå¦‚ï¼šé’ˆå¯¹æ•°æ®åˆ†æå²—ä½ä¼˜åŒ–å»ºè®®..." 
          value="{{inputVal}}" 
          bindinput="handleInput"
          bindconfirm="send"
          auto-height
          maxlength="2000"
          show-confirm-bar="false"
        ></textarea>
        
        <!-- å­—æ•°ç»Ÿè®¡ -->
        <view wx:if="{{inputVal.length > 0}}" class="char-count">
          <text class="count-text">{{inputVal.length}}/2000</text>
        </view>
      </view>
      
      <!-- å‘é€æŒ‰é’® -->
      <view class="send-button-wrapper">
        <button 
          class="send-button {{inputVal && !sending ? 'active' : 'disabled'}}" 
          bindtap="send" 
          disabled="{{!inputVal || sending}}"
        >
          <text wx:if="{{sending}}" class="send-icon loading">â³</text>
          <text wx:else class="send-icon">ğŸš€</text>
        </button>
      </view>
    </view>
  </view>
</view>