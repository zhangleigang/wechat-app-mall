<view class="page-container">
  <!-- é¡µé¢å¤´éƒ¨ -->
  <view class="warm-header">
    <text class="text-2xl text-bold text-white">æƒ…ç»ªå°å±‹</text>
    <text class="text-sm text-white mt-sm" style="opacity: 0.9;">
      ğŸŒ¸ æ¸©æš–é™ªä¼´ï¼Œå€¾å¬ä½ çš„å¿ƒå£°
    </text>
  </view>
  
  <!-- æƒ…ç»ªé€‰æ‹©ï¼ˆé¦–æ¬¡è¿›å…¥æ—¶æ˜¾ç¤ºï¼‰ -->
  <view wx:if="{{messages.length === 0}}" class="mood-selection-section">
    <view class="mood-title">
      <text class="mood-title-text">ğŸ’­ ä»Šå¤©æ„Ÿè§‰å¦‚ä½•ï¼Ÿ</text>
      <text class="mood-subtitle">é€‰æ‹©ä½ çš„æƒ…ç»ªï¼Œæˆ‘ä¼šé™ªä½ èŠèŠ</text>
    </view>
    
    <view class="mood-grid">
      <view 
        wx:for="{{moodOptions}}" 
        wx:key="index"
        class="mood-item"
        bindtap="selectMood"
        data-mood="{{item}}"
      >
        <text class="mood-emoji">{{item.emoji}}</text>
        <text class="mood-label">{{item.label}}</text>
      </view>
    </view>
  </view>
  
  <!-- å¯¹è¯åŒºåŸŸ -->
  <scroll-view 
    class="chat-container" 
    scroll-y="true" 
    scroll-top="{{scrollTop}}" 
    scroll-with-animation="true"
    enhanced="true"
    show-scrollbar="false"
  >
    <view class="messages-wrapper">
      <block wx:for="{{messages}}" wx:key="index">
        <view class="message-item {{item.role === 'user' ? 'user-message' : 'ai-message'}}">
          <!-- ç”¨æˆ·æ¶ˆæ¯ -->
          <view wx:if="{{item.role === 'user'}}" class="user-bubble">
            <view class="message-avatar user-avatar">
              <text class="avatar-text">æˆ‘</text>
            </view>
            <view class="message-bubble user-bubble-content">
              <text class="message-text">{{item.content}}</text>
              <text class="message-time">{{item.time}}</text>
            </view>
          </view>
          
          <!-- AIæ¶ˆæ¯ -->
          <view wx:else class="ai-bubble">
            <view class="message-avatar ai-avatar">
              <text class="avatar-text">ğŸŒ¸</text>
            </view>
            <view class="message-bubble ai-bubble-content">
              <text class="message-text">{{item.content}}</text>
              <text class="message-time">{{item.time}}</text>
              
              <!-- æ“ä½œæŒ‰é’® -->
              <view class="message-actions">
                <view class="action-btn" bindtap="copyMessage" data-content="{{item.content}}">
                  <text class="action-icon">ğŸ“‹</text>
                  <text class="action-text">å¤åˆ¶</text>
                </view>
                <view class="action-btn" bindtap="likeMessage" data-index="{{index}}">
                  <text class="action-icon">ğŸ’–</text>
                  <text class="action-text">æœ‰å¸®åŠ©</text>
                </view>
              </view>
            </view>
          </view>
        </view>
      </block>
      
      <!-- AIæ­£åœ¨å›å¤çš„æç¤º -->
      <view wx:if="{{sending}}" class="message-item ai-message">
        <view class="ai-bubble">
          <view class="message-avatar ai-avatar">
            <text class="avatar-text">ğŸŒ¸</text>
          </view>
          <view class="message-bubble ai-bubble-content typing-bubble">
            <view class="typing-indicator">
              <text class="typing-text">æ­£åœ¨å€¾å¬ä¸­</text>
              <view class="typing-dots">
                <view class="dot"></view>
                <view class="dot"></view>
                <view class="dot"></view>
              </view>
            </view>
          </view>
        </view>
      </view>
      
      <!-- åº•éƒ¨å ä½ -->
      <view class="messages-bottom"></view>
    </view>
  </scroll-view>
  
  <!-- è¾“å…¥åŒºåŸŸ -->
  <view class="input-section">
    <!-- åŠŸèƒ½æŒ‰é’®æ  -->
    <view wx:if="{{messages.length > 0}}" class="function-bar">
      <view class="function-btn" bindtap="clearChat">
        <text class="function-icon">ğŸ—‘ï¸</text>
        <text class="function-text">æ¸…ç©º</text>
      </view>
      <view class="function-btn" bindtap="exportChat">
        <text class="function-icon">ğŸ“¤</text>
        <text class="function-text">å¯¼å‡º</text>
      </view>
    </view>
    
    <!-- è¾“å…¥æ¡† -->
    <view class="input-container">
      <view class="input-wrapper">
        <textarea 
          class="message-input" 
          placeholder="è¯´è¯´ä½ çš„å‹åŠ›ã€å›°æ‰°æˆ–å½“å‰æƒ…ç»ª..." 
          value="{{inputVal}}" 
          bindinput="handleInput"
          bindconfirm="send"
          auto-height
          maxlength="2000"
          show-confirm-bar="false"
        ></textarea>
        
        <!-- å­—æ•°ç»Ÿè®¡ -->
        <view wx:if="{{inputVal.length > 0}}" class="char-count">
          <text class="count-text">{{inputVal.length}}/2000</text>
        </view>
      </view>
      
      <!-- å‘é€æŒ‰é’® -->
      <view class="send-button-wrapper">
        <button 
          class="send-button {{inputVal && !sending ? 'active' : 'disabled'}}" 
          bindtap="send" 
          disabled="{{!inputVal || sending}}"
        >
          <text wx:if="{{sending}}" class="send-icon loading">â³</text>
          <text wx:else class="send-icon">ğŸ’Œ</text>
        </button>
      </view>
    </view>
  </view>
</view>