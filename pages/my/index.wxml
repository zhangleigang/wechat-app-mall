<view class="page-container">
  <!-- æœªç™»å½•çŠ¶æ€ -->
  <view wx:if="{{ !apiUserInfoMap }}" class="login-container">
    <view class="gradient-header">
      <text class="text-3xl text-bold text-white mb-sm">ä¸ªäººä¸­å¿ƒ</text>
      <text class="text-sm text-white" style="opacity: 0.9;">ç™»å½•åæŸ¥çœ‹æ›´å¤šåŠŸèƒ½</text>
    </view>
    
    <view class="login-card">
      <text class="login-icon">ğŸ‘¤</text>
      <text class="login-title">æ¬¢è¿ä½¿ç”¨ AI é¢è¯•åŠ©æ‰‹</text>
      <text class="login-desc">ç™»å½•åå¯ä½¿ç”¨æ›´å¤šåŠŸèƒ½</text>
      <button class="btn btn-primary btn-block btn-lg mt-xl" bindtap="login">
        ç«‹å³ç™»å½•
      </button>
    </view>
  </view>

  <!-- å·²ç™»å½•çŠ¶æ€ -->
  <view wx:else>
    <!-- ç”¨æˆ·ä¿¡æ¯å¤´éƒ¨ -->
    <view class="gradient-header">
      <view class="user-header">
        <button class="avatar-btn" open-type="chooseAvatar" bind:chooseavatar="onChooseAvatar">
          <image 
            class="user-avatar" 
            src="{{ apiUserInfoMap.base.avatarUrl ? apiUserInfoMap.base.avatarUrl : '/images/default.png' }}" 
            mode="aspectFill"
          />
          <view class="avatar-edit-badge">
            <text class="edit-icon">âœï¸</text>
          </view>
        </button>
        
        <view class="user-info">
          <view class="user-nick" bindtap="editNick">
            <text class="nick-text">{{ apiUserInfoMap.base.nick ? apiUserInfoMap.base.nick : 'ç‚¹å‡»è®¾ç½®æ˜µç§°' }}</text>
            <text class="edit-hint">âœï¸</text>
          </view>
          
          <view class="user-id" bind:tap="copyUid">
            <text class="id-label">ID: {{ apiUserInfoMap.base.id }}</text>
            <text class="copy-hint">ğŸ“‹</text>
          </view>
          
          <view wx:if="{{ apiUserInfoMap.userLevel }}" class="user-level-badge">
            <text class="level-icon">ğŸ‘‘</text>
            <text class="level-name">{{ apiUserInfoMap.userLevel.name }}</text>
          </view>
        </view>
      </view>
    </view>

    <!-- ä¼šå‘˜ä¿¡æ¯å¡ç‰‡ -->
    <view class="member-card">
      <view class="member-header">
        <view class="member-title">
          <text class="member-icon">ğŸ’</text>
          <text class="member-text">ä¼šå‘˜æœåŠ¡</text>
        </view>
        <view class="member-status {{ memberExpireDate ? 'active' : 'inactive' }}">
          {{ memberExpireDate ? 'å·²å¼€é€š' : 'æœªå¼€é€š' }}
        </view>
      </view>
      
      <view class="member-body">
        <view class="member-info">
          <text class="info-label">æœ‰æ•ˆæœŸè‡³</text>
          <text class="info-value">{{ memberExpireDate ? memberExpireDate : '--' }}</text>
        </view>
      </view>
    </view>

    <!-- æ•°æ®ç»Ÿè®¡ -->
    <view class="stats-container">
      <view class="stat-item" bindtap="goAsset">
        <text class="stat-value">{{ balance }}</text>
        <text class="stat-label">ä½™é¢</text>
      </view>
      <view class="stat-divider"></view>
      <view class="stat-item" bindtap="goScore">
        <text class="stat-value">{{ score }}</text>
        <text class="stat-label">ç§¯åˆ†</text>
      </view>
      <view class="stat-divider"></view>
      <view class="stat-item" bindtap="gogrowth">
        <text class="stat-value">{{ growth }}</text>
        <text class="stat-label">æˆé•¿å€¼</text>
      </view>
    </view>

    <!-- è®¢å•ç»Ÿè®¡ -->
    <view class="order-section">
      <view class="section-title-bar">
        <text class="section-title">æˆ‘çš„è®¢å•</text>
        <view class="section-action" bindtap="goOrder" data-type="">
          <text class="action-text">å…¨éƒ¨è®¢å•</text>
          <text class="action-arrow">â†’</text>
        </view>
      </view>
      
      <view class="order-grid">
        <view class="order-item" bindtap="goOrder" data-type="0">
          <view class="order-icon-wrapper">
            <text class="order-icon">ğŸ’°</text>
            <view wx:if="{{ count_id_no_pay > 0 }}" class="order-badge">{{ count_id_no_pay }}</view>
          </view>
          <text class="order-label">å¾…ä»˜æ¬¾</text>
        </view>
        
        <view class="order-item" bindtap="goOrder" data-type="1">
          <view class="order-icon-wrapper">
            <text class="order-icon">ğŸ“¦</text>
            <view wx:if="{{ count_id_no_transfer > 0 }}" class="order-badge">{{ count_id_no_transfer }}</view>
          </view>
          <text class="order-label">å¾…å‘è´§</text>
        </view>
        
        <view class="order-item" bindtap="goOrder" data-type="2">
          <view class="order-icon-wrapper">
            <text class="order-icon">ğŸšš</text>
            <view wx:if="{{ count_id_no_confirm > 0 }}" class="order-badge">{{ count_id_no_confirm }}</view>
          </view>
          <text class="order-label">å¾…æ”¶è´§</text>
        </view>
        
        <view class="order-item" bindtap="goOrder" data-type="3">
          <view class="order-icon-wrapper">
            <text class="order-icon">â­</text>
            <view wx:if="{{ count_id_no_reputation > 0 }}" class="order-badge">{{ count_id_no_reputation }}</view>
          </view>
          <text class="order-label">å¾…è¯„ä»·</text>
        </view>
      </view>
    </view>

    <!-- åŠŸèƒ½èœå• -->
    <view class="menu-section">
      <view wx:if="{{ canHX }}" class="menu-item-card" bindtap="scanOrderCode">
        <view class="menu-item-left">
          <text class="menu-icon">ğŸ“·</text>
          <text class="menu-title">æ‰«ç æ ¸é”€</text>
        </view>
        <text class="menu-arrow">â†’</text>
      </view>
      
      <view class="menu-item-card" bindtap="goUserCode">
        <view class="menu-item-left">
          <text class="menu-icon">ğŸ«</text>
          <text class="menu-title">æˆ‘çš„äºŒç»´ç </text>
        </view>
        <text class="menu-arrow">â†’</text>
      </view>
      
      <view wx:if="{{ customerServiceType === 'XCX' }}" class="menu-item-card" bindtap="customerService">
        <view class="menu-item-left">
          <text class="menu-icon">ğŸ’¬</text>
          <text class="menu-title">è”ç³»å®¢æœ</text>
        </view>
        <text class="menu-arrow">â†’</text>
      </view>
    </view>
  </view>
</view>

<!-- ä¿®æ”¹æ˜µç§°å¼¹çª— -->
<van-dialog
  use-slot
  title="ä¿®æ”¹æ˜µç§°"
  show="{{ nickShow }}"
  show-cancel-button
  bind:confirm="_editNick"
>
  <van-field
    model:value="{{ nick }}"
    type="nickname"
    placeholder="è¯·è¾“å…¥æ˜µç§°"
    size="large"
    clearable
  />
</van-dialog>