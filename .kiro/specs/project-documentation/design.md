# 设计文档

## 概述

本设计文档描述了AI面试助手微信小程序的完整文档系统架构。该文档系统旨在为开发者、用户、管理员和其他利益相关者提供全面、结构化的信息，涵盖技术实现、使用指南、部署配置、安全合规等多个方面。

### 项目背景

AI面试助手是一个基于微信小程序的职业发展工具，集成了以下核心功能：
- **岗位分析**: 通过AI分析JD和岗位要求，提供职责概述、技能清单和面试准备建议
- **面试知识库**: 提供大数据技术（HDFS、Spark、Flink等）的结构化面试题库
- **简历解读**: AI解析简历文件，提供优化建议和岗位匹配分析
- **情绪小屋**: 提供面试压力管理和情绪支持
- **个人中心**: 用户信息管理和系统设置

### 文档系统目标

1. **降低学习曲线**: 帮助新开发者快速理解项目架构和代码组织
2. **提升开发效率**: 提供清晰的API文档和组件参考，减少重复查询
3. **改善用户体验**: 通过用户指南和FAQ帮助用户充分利用所有功能
4. **保障系统质量**: 通过测试文档和部署指南确保稳定性和可维护性
5. **确保合规性**: 提供安全和隐私文档，满足平台和法规要求

## 架构

### 文档系统架构

文档系统采用分层、模块化的架构设计，分为以下几个主要层次：

```
文档系统
├── 技术文档层 (Technical Documentation Layer)
│   ├── 架构文档
│   ├── API文档
│   ├── 组件文档
│   └── 开发指南
├── 用户文档层 (User Documentation Layer)
│   ├── 用户手册
│   ├── 功能教程
│   └── FAQ
├── 运维文档层 (Operations Documentation Layer)
│   ├── 部署指南
│   ├── 配置参考
│   └── 监控指南
└── 管理文档层 (Management Documentation Layer)
    ├── 内容管理
    ├── 测试文档
    └── 安全合规
```

### 小程序技术架构

```
微信小程序
├── 应用层 (App Layer)
│   ├── app.js - 应用生命周期
│   ├── app.json - 全局配置
│   └── app.wxss - 全局样式
├── 页面层 (Pages Layer)
│   ├── AI功能页面
│   │   ├── pages/ai/job - 岗位分析
│   │   ├── pages/ai/resume - 简历解读
│   │   └── pages/ai/mood - 情绪小屋
│   ├── 知识库页面
│   │   ├── pages/knowledge/index - 知识列表
│   │   └── pages/knowledge/detail - 知识详情
│   └── 用户页面
│       ├── pages/my - 个人中心
│       └── pages/login - 登录
├── 组件层 (Components Layer)
│   ├── 业务组件
│   │   ├── login - 登录组件
│   │   ├── bind-mobile - 绑定手机
│   │   └── payment - 支付组件
│   └── UI组件 (Vant Weapp)
├── 工具层 (Utils Layer)
│   ├── ai.js - AI服务接口
│   ├── auth.js - 认证工具
│   ├── knowledge.js - 知识库数据
│   └── tools.js - 通用工具
└── 配置层 (Config Layer)
    └── config.js - 应用配置
```

### 数据流架构

```
用户交互 → 页面层 → 工具层 → 后端服务
                ↓
            本地存储
         (wx.storage)
```

## 组件和接口

### 文档组件结构

#### 1. 技术文档组件

**1.1 架构概览文档 (ARCHITECTURE.md)**
- 目的: 描述系统整体架构和设计决策
- 内容结构:
  - 系统概述
  - 技术栈说明
  - 架构图和组件关系
  - 目录结构说明
  - 设计模式和最佳实践

**1.2 API文档 (API.md)**
- 目的: 详细说明所有后端接口
- 内容结构:
  - AI服务接口
    - POST /chat - AI对话接口
    - POST /resume/upload - 简历上传接口
  - 认证接口 (apifm-wxapi)
    - 用户登录
    - 用户信息获取
    - Token管理
  - 接口规范
    - 请求格式
    - 响应格式
    - 错误码说明
    - 认证机制

**1.3 组件参考文档 (COMPONENTS.md)**
- 目的: 记录所有可复用组件
- 内容结构:
  - 业务组件
    - login组件 - 登录弹窗
    - bind-mobile组件 - 手机绑定
    - payment组件 - 支付处理
  - 每个组件包含:
    - 功能说明
    - 属性(Props)列表
    - 事件(Events)列表
    - 使用示例
    - 注意事项

**1.4 开发环境搭建指南 (SETUP.md)**
- 目的: 指导新开发者配置开发环境
- 内容结构:
  - 前置要求
  - 微信开发者工具安装
  - 项目克隆和依赖安装
  - 配置文件设置
  - 本地调试方法
  - 常见问题解决

#### 2. 用户文档组件

**2.1 用户手册 (USER_GUIDE.md)**
- 目的: 帮助用户理解和使用所有功能
- 内容结构:
  - 快速开始
  - 功能详解
    - 岗位分析使用方法
    - 知识库浏览和搜索
    - 简历上传和解读
    - 情绪支持功能
    - 个人信息管理
  - 操作技巧
  - 注意事项

**2.2 功能教程 (TUTORIALS.md)**
- 目的: 提供分步骤的操作指导
- 内容结构:
  - 教程1: 如何使用岗位分析功能
  - 教程2: 如何搜索和学习面试知识
  - 教程3: 如何上传和优化简历
  - 教程4: 如何使用情绪支持功能
  - 每个教程包含截图和详细步骤

**2.3 常见问题 (FAQ.md)**
- 目的: 解答用户常见疑问
- 内容结构:
  - 账号和登录问题
  - 功能使用问题
  - AI服务相关问题
  - 数据和隐私问题
  - 技术支持联系方式

**2.4 隐私政策 (PRIVACY.md)**
- 目的: 说明数据收集和使用政策
- 内容结构:
  - 收集的信息类型
  - 信息使用方式
  - 数据存储和保护
  - 用户权利
  - 政策更新说明

#### 3. 运维文档组件

**3.1 部署指南 (DEPLOYMENT.md)**
- 目的: 指导小程序发布流程
- 内容结构:
  - 发布前检查清单
  - 微信小程序提交流程
  - 版本管理策略
  - 审核注意事项
  - 发布后验证

**3.2 配置参考 (CONFIGURATION.md)**
- 目的: 详细说明所有配置项
- 内容结构:
  - config.js配置说明
    - subDomain - 专属域名
    - merchantId - 商户ID
    - ai_api_base - AI服务地址
    - ai_api_key - API密钥
    - 其他配置项
  - app.json配置说明
  - 环境变量管理

**3.3 后端集成指南 (BACKEND_INTEGRATION.md)**
- 目的: 说明如何连接后端服务
- 内容结构:
  - AI服务集成
    - 接口规范
    - 认证配置
    - 错误处理
  - apifm-wxapi集成
    - SDK初始化
    - 商户配置
  - 第三方服务集成

**3.4 监控和故障排除 (MONITORING.md)**
- 目的: 提供运维监控和问题诊断方法
- 内容结构:
  - 日志查看方法
  - 性能监控指标
  - 常见错误和解决方案
  - 应急响应流程

#### 4. 管理文档组件

**4.1 知识库管理指南 (KNOWLEDGE_MANAGEMENT.md)**
- 目的: 指导内容管理员维护知识库
- 内容结构:
  - 知识库数据结构
    - categories数组结构
    - topics数组结构
    - FAQ和答案格式
  - 添加新分类的步骤
  - 添加新主题的步骤
  - 内容质量标准
  - 更新和发布流程

**4.2 测试文档 (TESTING.md)**
- 目的: 确保功能质量
- 内容结构:
  - 测试策略
  - 功能测试用例
    - 岗位分析测试
    - 知识库测试
    - 简历解读测试
    - 情绪支持测试
    - 用户中心测试
  - 集成测试场景
  - 性能测试标准
  - 缺陷报告模板

**4.3 安全文档 (SECURITY.md)**
- 目的: 说明安全机制和合规要求
- 内容结构:
  - 认证和授权机制
  - 数据加密和传输安全
  - Token管理
  - 敏感信息处理
  - 安全审计日志
  - 漏洞响应流程

**4.4 变更日志 (CHANGELOG.md)**
- 目的: 记录版本变更历史
- 内容结构:
  - 按版本组织
  - 每个版本包含:
    - 新增功能
    - 功能改进
    - 缺陷修复
    - 已知问题
  - 发布日期

### 接口设计

#### AI服务接口

**聊天接口**
```javascript
// 请求
POST {ai_api_base}/chat
Headers: {
  'Content-Type': 'application/json',
  'Authorization': 'Bearer {ai_api_key}' // 可选
}
Body: {
  scene: 'job' | 'resume' | 'mood',
  sessionId: string,
  userId: string,
  token: string,
  messages: Array<{role: string, content: string}>
}

// 响应
{
  answer: string,
  // 或
  data: any
}
```

**简历上传接口**
```javascript
// 请求
POST {ai_api_base}/resume/upload
Headers: {
  'Authorization': 'Bearer {ai_api_key}' // 可选
}
FormData: {
  file: File,
  userId: string,
  token: string
}

// 响应
{
  resumeText: string
}
```

## 数据模型

### 知识库数据模型

**分类模型 (Category)**
```javascript
{
  key: string,      // 分类唯一标识，如 'hdfs'
  name: string      // 分类显示名称，如 'HDFS'
}
```

**主题模型 (Topic)**
```javascript
{
  id: string,           // 主题唯一标识
  title: string,        // 主题标题
  summary: string,      // 主题摘要
  tags: string[],       // 标签数组
  categoryKey: string,  // 所属分类key
  faqs: string[],       // 问题列表
  answers: string[],    // 答案列表（与faqs一一对应）
  examples: any[]       // 示例代码或案例
}
```

### 用户数据模型

**用户信息**
```javascript
{
  uid: string,          // 用户ID
  token: string,        // 认证令牌
  nick: string,         // 昵称
  avatarUrl: string,    // 头像URL
  mobile: string        // 手机号
}
```

### 会话数据模型

**AI对话消息**
```javascript
{
  role: 'system' | 'user' | 'assistant',
  content: string
}
```

**会话状态**
```javascript
{
  sessionId: string,    // 会话ID
  messages: Message[],  // 消息历史
  sending: boolean      // 发送状态
}
```

## 错误处理

### 错误处理策略

1. **网络错误**: 显示友好提示，建议用户检查网络连接
2. **AI服务错误**: 捕获异常，显示"AI服务异常"提示
3. **认证错误**: 引导用户重新登录
4. **文件上传错误**: 提示上传失败原因，支持重试
5. **数据解析错误**: 记录错误日志，显示默认内容

### 错误码规范

文档中应包含完整的错误码表：

| 错误码 | 说明 | 处理方式 |
|--------|------|----------|
| 401 | 未授权 | 重新登录 |
| 403 | 禁止访问 | 检查权限配置 |
| 404 | 资源不存在 | 检查请求路径 |
| 500 | 服务器错误 | 联系技术支持 |
| 1001 | Token过期 | 刷新Token |
| 2001 | AI服务不可用 | 稍后重试 |

## 测试策略

### 文档测试方法

1. **准确性测试**: 验证文档内容与实际代码一致
2. **完整性测试**: 确保所有功能都有对应文档
3. **可读性测试**: 邀请新开发者阅读并提供反馈
4. **示例测试**: 验证所有代码示例可以正常运行

### 功能测试覆盖

文档应包含以下测试用例：

**岗位分析功能测试**
- 输入JD文本，验证AI返回分析结果
- 测试快捷问题功能
- 测试会话历史保持
- 测试网络异常处理

**知识库功能测试**
- 测试分类切换
- 测试搜索功能
- 测试主题详情跳转
- 测试数据过滤逻辑

**简历解读功能测试**
- 测试文件选择和上传
- 测试简历解析结果
- 测试AI对话功能
- 测试上传失败处理

**情绪支持功能测试**
- 测试对话交互
- 测试情绪识别
- 测试建议生成

**用户中心功能测试**
- 测试登录流程
- 测试用户信息展示
- 测试头像和昵称修改
- 测试退出登录

## 文档维护流程

### 文档更新工作流

```
代码变更 → 识别文档影响 → 更新相关文档 → 文档审查 → 发布文档
```

### 文档版本管理

1. 文档与代码版本同步
2. 使用Git管理文档变更
3. 重大变更需要版本说明
4. 保留历史版本文档

### 文档审查标准

- 技术准确性
- 内容完整性
- 语言清晰度
- 格式一致性
- 示例可用性

## 工具和技术

### 文档编写工具

- **Markdown**: 所有文档使用Markdown格式
- **Mermaid**: 用于绘制架构图和流程图
- **截图工具**: 用于用户指南的界面截图
- **代码高亮**: 使用语法高亮提升可读性

### 文档托管方案

- **代码仓库**: 文档与代码一起存储在Git仓库
- **在线文档**: 可选择部署到文档网站（如GitBook、VuePress）
- **离线文档**: 支持导出PDF格式

### 文档生成工具

- **JSDoc**: 从代码注释生成API文档
- **自动化脚本**: 生成目录结构文档
- **模板系统**: 使用统一的文档模板

## 安全和合规

### 文档安全考虑

1. **敏感信息保护**: 文档中不包含真实的API密钥、Token等
2. **访问控制**: 内部文档和公开文档分离
3. **版本控制**: 使用Git追踪文档变更历史

### 合规性要求

文档应涵盖以下合规内容：

1. **微信小程序平台规范**
   - 用户隐私保护
   - 数据安全要求
   - 内容审核标准

2. **数据保护法规**
   - 个人信息收集说明
   - 数据使用授权
   - 用户权利保障

3. **知识产权**
   - 开源协议说明
   - 第三方组件许可
   - 内容版权声明

## 性能考虑

### 文档加载优化

1. 文档分模块组织，按需加载
2. 图片使用压缩格式
3. 代码示例使用折叠展示
4. 提供搜索功能快速定位

### 文档可访问性

1. 使用清晰的标题层次
2. 提供目录导航
3. 支持全文搜索
4. 移动端友好展示

## 国际化支持

虽然当前项目主要面向中文用户，但文档系统应考虑未来的国际化需求：

1. 文档结构支持多语言版本
2. 使用i18n标准组织翻译内容
3. 技术术语保持一致性
4. 截图和示例考虑本地化

## 总结

本设计文档定义了一个全面、结构化的文档系统，涵盖技术、用户、运维和管理四个主要层次。通过模块化的组件设计和清晰的接口规范，该文档系统将有效支持项目的开发、部署、使用和维护。

文档系统的核心设计原则：
- **完整性**: 覆盖所有功能和流程
- **准确性**: 与实际代码保持同步
- **可读性**: 清晰的结构和语言
- **可维护性**: 易于更新和扩展
- **实用性**: 提供可执行的指导和示例
